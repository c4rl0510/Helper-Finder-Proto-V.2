<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enhanced Helper Finder with Skills Filter</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #3498db;
      --primary-dark: #2980b9;
      --secondary: #2ecc71;
      --dark: #2c3e50;
      --light: #ecf0f1;
      --gray: #95a5a6;
      --danger: #e74c3c;
      --success: #2ecc71;
      --warning: #f39c12;
      --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      font-size: 16px;
      margin: 0;
      font-weight: normal;
      background: linear-gradient(135deg, #f8f9fa, #e4edf9);
      color: #333;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: 15px;
      box-shadow: var(--card-shadow);
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.8s ease-out;
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }

    .logo-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .logo {
      max-width: min(100%, 400px);
      height: auto;
      max-height: 100px;
    }

    .tagline {
      font-size: 1.2rem;
      color: var(--gray);
      max-width: 600px;
      margin: 0 auto;
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .filters {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: var(--card-shadow);
      margin-bottom: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 20px;
      animation: slideUp 0.6s ease-out;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
    }

    .filter-group label {
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
      font-size: 1rem;
      display: flex;
      align-items: center;
    }

    .filter-group label i {
      margin-right: 8px;
      color: var(--primary);
    }

    input, select {
      padding: 14px 18px;
      font-size: 16px;
      border: 2px solid #e0e6ed;
      border-radius: 10px;
      transition: var(--transition);
      background: #f8f9fa;
      width: 100%;
    }

    input:focus, select:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
      background: white;
    }

    button {
      padding: 14px 20px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: var(--transition);
    }

    .button-group {
      display: flex;
      gap: 15px;
      grid-column: 1 / -1;
      margin-top: 10px;
    }

    .button-group button {
      flex: 1;
    }

    .search-btn {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .search-btn:hover {
      background: linear-gradient(135deg, var(--primary-dark), #1d6fa5);
      transform: translateY(-3px);
      box-shadow: 0 7px 15px rgba(52, 152, 219, 0.4);
    }

    .reset-btn {
      background: linear-gradient(135deg, #95a5a6, #7f8c8d);
      color: white;
    }

    .reset-btn:hover {
      background: linear-gradient(135deg, #7f8c8d, #6c7a7d);
      transform: translateY(-3px);
    }

    #search {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23808c99" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>');
      background-repeat: no-repeat;
      background-position: 18px center;
      background-size: 20px;
      padding-left: 50px;
    }

    .search-hint {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 8px;
      padding-left: 5px;
      font-style: italic;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
      animation: fadeIn 0.8s ease-out;
    }

    .results-count {
      background: var(--primary);
      color: white;
      padding: 8px 20px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 1.1rem;
      box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
    }

    .helper-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .helper {
      background: white;
      border: 1px solid #e0e6ed;
      border-radius: 15px;
      padding: 25px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
      animation: fadeIn 0.6s ease-out;
    }

    .helper:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      border-color: #c2dbf7;
    }

    .helper.rejected {
      opacity: 0.8;
      background: linear-gradient(135deg, #f8f9fa, #fff0f0);
    }

    .helper.rejected::before {
      content: 'REJECTED';
      position: absolute;
      top: 15px;
      right: -30px;
      background: var(--danger);
      color: white;
      padding: 4px 35px;
      font-size: 14px;
      font-weight: bold;
      transform: rotate(45deg);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      letter-spacing: 1px;
    }

    .helper-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e9ecef;
    }

    .helper-name-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .helper-name {
      font-size: 1.3rem;
      color: var(--dark);
      margin: 0;
    }

    .copy-name-btn {
      background: transparent;
      border: none;
      color: var(--gray);
      cursor: pointer;
      padding: 6px;
      border-radius: 50%;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
    }

    .copy-name-btn:hover {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--primary);
    }

    .helper-code {
      background: #e9f7fe;
      color: var(--primary);
      padding: 6px 15px;
      border-radius: 30px;
      font-weight: bold;
      font-size: 0.95rem;
    }

    .helper-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      background: #f8f9fa;
      padding: 12px;
      border-radius: 10px;
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--gray);
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stat-value {
      font-weight: 600;
      font-size: 1.2rem;
      color: var(--dark);
      padding-left: 5px;
    }

    .badge-container {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 15px 0 20px;
    }

    .badge {
      background: #f8f8f8;
      color: var(--primary);
      padding: 8px 15px;
      border-radius: 30px;
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
    }

    .badge.active {
      background: #d4edda;
      color: #155724;
    }

    .badge i {
      font-size: 1.1rem;
    }

    .comments {
      background: #f8f9fa;
      padding: 18px;
      border-radius: 10px;
      margin-top: auto;
      border-left: 4px solid var(--primary);
      font-size: 1rem;
      line-height: 1.5;
    }

    .comments strong {
      color: var(--dark);
    }

    .empty-results {
      text-align: center;
      padding: 60px 20px;
      background: white;
      border-radius: 15px;
      box-shadow: var(--card-shadow);
      grid-column: 1 / -1;
    }

    .empty-results i {
      font-size: 5rem;
      color: var(--gray);
      margin-bottom: 20px;
      opacity: 0.6;
    }

    .empty-results h3 {
      font-size: 1.8rem;
      color: var(--dark);
      margin-bottom: 15px;
    }

    .empty-results p {
      color: var(--gray);
      max-width: 500px;
      margin: 0 auto;
      font-size: 1.1rem;
    }

    .helpers-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 20px;
    }

    /* Pagination Styles */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 30px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .pagination-btn {
      padding: 10px 18px;
      background: white;
      border: 1px solid #e0e6ed;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .pagination-btn:hover:not(:disabled) {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .page-info {
      font-weight: 600;
      color: var(--dark);
      padding: 0 15px;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      z-index: 1000;
      transform: translateX(120%);
      transition: transform 0.4s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: var(--success);
    }

    .notification.error {
      background: var(--danger);
    }

    .notification.info {
      background: var(--primary);
    }

    /* Skills Filter */
    .skills-filter-container {
      grid-column: span 2;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #e0e6ed;
    }

    .skills-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .skills-header i {
      color: var(--primary);
      margin-right: 10px;
      font-size: 1.2rem;
    }

    .skills-header h4 {
      color: var(--dark);
      font-size: 1.1rem;
    }

    .skills-select-container {
      position: relative;
      width: 100%;
    }

    .skills-select {
      width: 100%;
      padding: 14px 18px;
      font-size: 16px;
      border: 2px solid #e0e6ed;
      border-radius: 10px;
      background: white;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .skills-select.active {
      border-color: var(--primary);
    }

    .skills-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      max-height: 300px;
      overflow-y: auto;
      background: white;
      border: 2px solid #e0e6ed;
      border-top: none;
      border-radius: 0 0 10px 10px;
      z-index: 100;
      display: none;
      box-shadow: 0 10px 15px rgba(0,0,0,0.1);
    }

    .skills-dropdown.active {
      display: block;
    }

    .skill-option {
      padding: 12px 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: background 0.2s;
    }

    .skill-option:hover {
      background: #f0f7ff;
    }

    .skill-option input {
      margin-right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .selected-skills {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .selected-skill {
      background: #e1f0fa;
      color: var(--primary);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .selected-skill i {
      cursor: pointer;
      font-size: 0.9rem;
    }

    .selected-skill i:hover {
      color: var(--danger);
    }

    @media (max-width: 768px) {
      .filters {
        grid-template-columns: 1fr;
      }
      
      .skills-filter-container {
        grid-column: span 1;
      }
      
      .button-group {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .helper-stats {
        grid-template-columns: 1fr;
      }
      
      .helper-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .results-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo-container">
        <p class="tagline" style="font-size:1.1rem;">Reliable Domestic Helper Solutions Tailored to Your Family's Needs</p>
      </div>
    </header>

    <div class="filters">
      <div class="filter-group">
        <label for="search"><i class="fas fa-search"></i> Search Helpers</label>
        <input type="text" id="search" placeholder="Name, skills, or keywords" onkeydown="checkEnter(event)" />
        <div class="search-hint">Separate multiple terms with commas or spaces</div>
      </div>

      <div class="filter-group">
        <label for="nationality"><i class="fas fa-globe-asia"></i> Nationality</label>
        <select id="nationality">
          <option value="">All Nationalities</option>
          <option value="Filipino">Filipino</option>
          <option value="Indonesian">Indonesian</option>
          <option value="Burmese">Burmese</option>
          <option value="Indian">Indian</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="experience"><i class="fas fa-briefcase"></i> Experience</label>
        <select id="experience">
          <option value="">All Experience</option>
          <option value="Myanmar">Myanmar</option>
          <option value="Philippines">Philippines</option>
          <option value="Indonesia">Indonesia</option>
          <option value="Singapore">Singapore</option>
          <option value="HongKong">HongKong</option>
          <option value="Taiwan">Taiwan</option>
          <option value="Middle East">Middle East</option>
          <option value="Malaysia">Malaysia</option>
          <option value="Other">Other</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="religion"><i class="fas fa-pray"></i> Religion</label>
        <select id="religion">
          <option value="">All Religions</option>
          <option value="Christianity">Christianity</option>
          <option value="Islam">Islam</option>
          <option value="Buddhism">Buddhism</option>
          <option value="Hinduism">Hinduism</option>
          <option value="Others">Others</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="heightRange"><i class="fas fa-arrows-alt-v"></i> Height Range</label>
        <select id="heightRange">
          <option value="">Any Height</option>
          <option value="145-150">145-150 cm</option>
          <option value="150-155">150-155 cm</option>
          <option value="155-160">155-160 cm</option>
          <option value="160-165">160-165 cm</option>
          <option value="165-170">165-170 cm</option>
          <option value="170-175">170-175 cm</option>
          <option value="175-180">175-180 cm</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="weightRange"><i class="fas fa-weight"></i> Weight Range</label>
        <select id="weightRange">
          <option value="">Any Weight</option>
          <option value="40-50">40-50 kg</option>
          <option value="51-60">51-60 kg</option>
          <option value="61-70">61-70 kg</option>
          <option value="71-80">71-80 kg</option>
          <option value="81-90">81-90 kg</option>
          <option value="91-100">91-100 kg</option>
          <option value="101-110">101-110 kg</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="salaryRange"><i class="fas fa-dollar-sign"></i> Salary Range</label>
        <select id="salaryRange">
          <option value="">Any Salary</option>
          <option value="500-600">S$500 - S$600</option>
          <option value="601-700">S$601 - S$700</option>
          <option value="701-800">S$701 - S$800</option>
          <option value="801-1200">S$801 - S$1200</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="sortBy"><i class="fas fa-sort"></i> Sort By</label>
        <select id="sortBy">
          <option value="">Default Order</option>
          <option value="height-asc">Height (Low-High)</option>
          <option value="height-desc">Height (High-Low)</option>
          <option value="weight-asc">Weight (Low-High)</option>
          <option value="weight-desc">Weight (High-Low)</option>
          <option value="age-asc">Age (Low-High)</option>
          <option value="age-desc">Age (High-Low)</option>
        </select>
      </div>

      <!-- Skills Filter Container -->
      <div class="skills-filter-container">
        <div class="skills-header">
          <i class="fas fa-tools"></i>
          <h4>Select Required Skills</h4>
        </div>
        <div class="skills-select-container">
          <div class="skills-select" id="skillsSelect">
            <span>Select skills...</span>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div class="skills-dropdown" id="skillsDropdown">
            <div class="skill-option">
              <input type="checkbox" id="housekeeping" value="housekeeping">
              <label for="housekeeping">Housekeeping</label>
            </div>
            <div class="skill-option">
              <input type="checkbox" id="cooking" value="cooking">
              <label for="cooking">Cooking</label>
            </div>
            <div class="skill-option">
              <input type="checkbox" id="childCare" value="childCare">
              <label for="childCare">Child Care</label>
            </div>
            <div class="skill-option">
              <input type="checkbox" id="infantCare" value="infantCare">
              <label for="infantCare">Infant Care</label>
            </div>
            <div class="skill-option">
              <input type="checkbox" id="elderCare" value="elderCare">
              <label for="elderCare">Elder Care</label>
            </div>
            <div class="skill-option">
              <input type="checkbox" id="petCare" value="petCare">
              <label for="petCare">Pet Care</label>
            </div>
          </div>
        </div>
        <div class="selected-skills" id="selectedSkills"></div>
      </div>

      <div class="button-group">
        <button class="search-btn" onclick="searchHelpers()">
          <i class="fas fa-search"></i> Search Helpers
        </button>
        <button class="reset-btn" onclick="resetFilters()">
          <i class="fas fa-redo"></i> Reset Filters
        </button>
      </div>
    </div>

    <div class="results-header">
      <h2>Available Helpers</h2>
      <div class="results-count" id="resultsCount">Loading helpers...</div>
    </div>

    <div class="helper-grid" id="results">
      <div class="empty-results">
        <i class="fas fa-spinner fa-spin"></i>
        <h3>Loading Helper Data</h3>
        <p>Please wait while we load helper information from the database</p>
      </div>
    </div>
    
    <!-- Pagination Container -->
    <div class="pagination" id="pagination">
      <button class="pagination-btn" id="prevBtn" disabled>
        <i class="fas fa-chevron-left"></i> Prev
      </button>
      <div class="page-info" id="pageInfo">Page 1 of 1</div>
      <button class="pagination-btn" id="nextBtn" disabled>
        Next <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
  
  <div class="notification" id="notification"></div>

  <script>
    // script.js
    let helpers = [];
    let originalHelpers = [];
    let currentPage = 1;
    const helpersPerPage = 6;
    let totalPages = 1;
    let filteredHelpers = [];
    const skillsMap = {
      housekeeping: "Housekeeping",
      cooking: "Cooking",
      childCare: "Child Care",
      infantCare: "Infant Care",
      elderCare: "Elder Care",
      petCare: "Pet Care"
    };

    // Notification function
    function showNotification(message, type) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Copy name to clipboard function
    function copyHelperName(name) {
      navigator.clipboard.writeText(name)
        .then(() => {
          showNotification(`Copied: ${name}`, 'success');
        })
        .catch(err => {
          console.error('Failed to copy: ', err);
          showNotification('Failed to copy name', 'error');
        });
    }

    // Extract numeric value from salary string
    function extractSalary(salaryStr) {
      if (!salaryStr) return 0;
      
      // Match numbers in the salary string
      const matches = salaryStr.match(/\d+/g);
      if (!matches || matches.length === 0) return 0;
      
      // Convert to numbers and find the maximum value
      const nums = matches.map(match => parseInt(match, 10));
      return Math.max(...nums);
    }

    async function loadData() {
      try {
        document.getElementById('resultsCount').textContent = "Loading helpers...";
        // Show loading state
        document.getElementById('results').innerHTML = `
          <div class="empty-results">
            <i class="fas fa-spinner fa-spin"></i>
            <h3>Loading Helper Data</h3>
            <p>Please wait while we load helper information from the database</p>
          </div>
        `;

        // Fetch data from SheetBest API
        const res = await fetch('https://api.sheetbest.com/sheets/8da0a252-39e0-44ce-8f44-67f91884b9c1');
        if (!res.ok) {
          throw new Error(`Failed to fetch data: ${res.status} ${res.statusText}`);
        }
        const json = await res.json();

        // Check if we have data
        if (!json || json.length === 0) {
          throw new Error("No data available in the response");
        }

        // Convert API data to our format
        helpers = json.map(h => ({
          code: h["MDW Code"] || 'N/A',
          status: h["MDW Status"] || '',
          name: h["MDW Name"] || 'Unknown',
          nationality: h["Nationality"] || 'Unknown',
          experience: h["MDW Experience"] || 'Not specified',
          dob: h["MDW DOB"] || '',
          height: (h["MDW Height"] || '').replace('cm', '').trim(),
          weight: (h["MDW Weight"] || '').replace('kg', '').trim(),
          restDay: h["Rest Day Arrangement"] || 'Not specified',
          housekeeping: h["Domestic Houskeeping"] === 'FALSE' ? false : true,
          cooking: h["Cooking"] === 'False' ? false : true,
          elderCare: h["Elder Care"] === 'TRUE',
          childCare: h["Child Care"] === 'TRUE',
          infantCare: h["Infant Care"] === 'TRUE',
          petCare: h["Pet Care"] === 'TRUE',
          comments: h["Interviewer Comments"] || 'No comments available',
          salary: h["Expected Salary"] || 'Not specified',
          religion: h["Religion"] || 'Not specified',
          salaryValue: extractSalary(h["Expected Salary"] || '') // Extract numeric salary
        }));

        // Calculate age and status flags
        helpers.forEach(h => {
          h.age = calculateAge(h.dob);
          const statusStr = (h.status || '').toLowerCase();
          h.isRejected = statusStr.includes('rejected');
          h.isWithdrew = statusStr.includes('void');
          h.isSelected = statusStr.includes('selected');
        });

        originalHelpers = [...helpers];

        // Filter non-rejected helpers AND those with non-blank status
        const nonRejected = helpers.filter(h =>
          !h.isRejected && 
          !h.isWithdrew && 
          !h.isSelected &&
          h.status.trim() !== '' // Hide blank status helpers
        );

        filteredHelpers = [...nonRejected];
        updatePagination(filteredHelpers);
        displayResults(getPaginatedData(filteredHelpers));

        document.getElementById('resultsCount').textContent =
          `${nonRejected.length} Helper${nonRejected.length === 1 ? '' : 's'} Found`;

        showNotification('Helpers data loaded successfully!', 'success');
      } catch (err) {
        console.error('Failed to load:', err);
        document.getElementById('results').innerHTML = `
          <div class="empty-results">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Error Loading Data</h3>
            <p>${err.message || 'Please check your connection and try again later.'}</p>
            <button class="search-btn" onclick="loadData()" style="margin-top:20px;padding:12px 25px;">
              <i class="fas fa-redo"></i> Retry
            </button>
          </div>
        `;
        document.getElementById('resultsCount').textContent = "Error loading data";
        showNotification('Failed to load helper data', 'error');
      }
    }

    function calculateAge(dob) {
      if (!dob) return null;

      // Parse date in format "D MMM YYYY", e.g., "1 Jan 1990"
      const parts = dob.trim().split(' ');
      if (parts.length !== 3) return null;

      const day = parseInt(parts[0], 10);
      const monthStr = parts[1].toLowerCase();
      const year = parseInt(parts[2], 10);

      // Map month short names to numbers
      const months = ["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];
      const month = months.indexOf(monthStr);
      if (month === -1 || isNaN(day) || isNaN(year)) return null;

      const birthDate = new Date(year, month, day);
      if (isNaN(birthDate.getTime())) return null;

      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();

      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }

      return age;
    }

    function checkEnter(e) {
      if (e.key === 'Enter') searchHelpers();
    }

    // Get selected skills
    function getSelectedSkills() {
      const skills = [];
      document.querySelectorAll('.skills-dropdown input[type="checkbox"]:checked').forEach(checkbox => {
        skills.push(checkbox.value);
      });
      return skills;
    }

    // Update selected skills display
    function updateSelectedSkillsDisplay() {
      const selectedSkillsContainer = document.getElementById('selectedSkills');
      selectedSkillsContainer.innerHTML = '';
      
      const selectedSkills = getSelectedSkills();
      selectedSkills.forEach(skill => {
        const skillElement = document.createElement('div');
        skillElement.className = 'selected-skill';
        skillElement.innerHTML = `
          <span>${skillsMap[skill]}</span>
          <i class="fas fa-times" onclick="removeSkill('${skill}')"></i>
        `;
        selectedSkillsContainer.appendChild(skillElement);
      });
      
      // Update the skills select text
      const skillsSelect = document.getElementById('skillsSelect');
      if (selectedSkills.length > 0) {
        skillsSelect.querySelector('span').textContent = selectedSkills.map(skill => skillsMap[skill]).join(', ');
      } else {
        skillsSelect.querySelector('span').textContent = 'Select skills...';
      }
    }

    // Remove a selected skill
    function removeSkill(skill) {
      const checkbox = document.getElementById(skill);
      if (checkbox) {
        checkbox.checked = false;
        updateSelectedSkillsDisplay();
      }
    }

    function searchHelpers() {
      const searchInput = document.getElementById('search').value.trim();
      const nationality = document.getElementById('nationality').value.toLowerCase();
      const experience = document.getElementById('experience').value.toLowerCase();
      const religion = document.getElementById('religion').value.toLowerCase();
      const heightRange = document.getElementById('heightRange').value;
      const weightRange = document.getElementById('weightRange').value;
      const salaryRange = document.getElementById('salaryRange').value;
      const sortBy = document.getElementById('sortBy').value;
      
      // Get selected skills
      const selectedSkills = getSelectedSkills();

      // Process search terms - split by comma or space and remove empty terms
      const searchTerms = searchInput
        .split(/[,\s]+/)
        .filter(term => term.length > 0)
        .map(term => term.toLowerCase());

      let heightMin = 0, heightMax = Infinity;
      if (heightRange) [heightMin, heightMax] = heightRange.split('-').map(Number);

      let weightMin = 0, weightMax = Infinity;
      if (weightRange) [weightMin, weightMax] = weightRange.split('-').map(Number);

      let salaryMin = 0, salaryMax = Infinity;
      if (salaryRange) [salaryMin, salaryMax] = salaryRange.split('-').map(Number);

      // Filter out rejected helpers AND those with blank status
      let filtered = helpers.filter(h => 
        !h.isRejected && 
        !h.isWithdrew && 
        !h.isSelected &&
        h.status.trim() !== '' // Hide blank status helpers
      );

      // Apply other filters
      filtered = filtered.filter(h => {
        const height = parseInt(h.height) || 0;
        const weight = parseInt(h.weight) || 0;
        const salary = h.salaryValue || 0;

        // Check if helper matches all search terms
        const matchesAllSearchTerms = searchTerms.length === 0 || 
          searchTerms.every(term => 
            h.name.toLowerCase().includes(term) || 
            h.comments.toLowerCase().includes(term) ||
            h.experience.toLowerCase().includes(term) ||
            h.restDay.toLowerCase().includes(term) ||
            h.salary.toLowerCase().includes(term)
          );
        
        // Check if helper has all selected skills
        const hasAllSelectedSkills = selectedSkills.every(skill => {
          switch(skill) {
            case 'housekeeping': return h.housekeeping;
            case 'cooking': return h.cooking;
            case 'childCare': return h.childCare;
            case 'infantCare': return h.infantCare;
            case 'elderCare': return h.elderCare;
            case 'petCare': return h.petCare;
            default: return true;
          }
        });

        return (
          matchesAllSearchTerms &&
          hasAllSelectedSkills &&
          (!nationality || h.nationality.toLowerCase() === nationality) &&
          (!experience || h.experience.toLowerCase() === experience) &&
          (!religion || h.religion.toLowerCase() === religion) &&
          (height >= heightMin && height <= heightMax) &&
          (weight >= weightMin && weight <= weightMax) &&
          (salary >= salaryMin && salary <= salaryMax)
        );
      });

      // Apply sorting
      if (sortBy) {
        const [key, order] = sortBy.split('-');
        filtered.sort((a, b) => {
          let valA, valB;

          switch (key) {
            case 'name':
              valA = a.name.toLowerCase();
              valB = b.name.toLowerCase();
              return order === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
            
            case 'height':
              valA = parseInt(a.height) || 0;
              valB = parseInt(b.height) || 0;
              return order === 'asc' ? valA - valB : valB - valA;
            
            case 'weight':
              valA = parseInt(a.weight) || 0;
              valB = parseInt(b.weight) || 0;
              return order === 'asc' ? valA - valB : valB - valA;
            
            case 'age':
              valA = a.age || 0;
              valB = b.age || 0;
              return order === 'asc' ? valA - valB : valB - valA;
            
            default:
              return 0;
          }
        });
      }

      filteredHelpers = [...filtered];
      currentPage = 1;
      updatePagination(filteredHelpers);
      displayResults(getPaginatedData(filteredHelpers));
      
      document.getElementById('resultsCount').textContent = `${filtered.length} Helper${filtered.length === 1 ? '' : 's'} Found`;
      
      if (filtered.length === 0) {
        showNotification('No helpers found with current filters', 'info');
      } else {
        showNotification(`Found ${filtered.length} helpers`, 'success');
      }
    }

    function resetFilters() {
      document.getElementById('search').value = '';
      document.getElementById('nationality').value = '';
      document.getElementById('experience').value = '';
      document.getElementById('religion').value = '';
      document.getElementById('heightRange').value = '';
      document.getElementById('weightRange').value = '';
      document.getElementById('salaryRange').value = '';
      document.getElementById('sortBy').value = '';
      
      // Reset skills
      document.querySelectorAll('.skills-dropdown input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      updateSelectedSkillsDisplay();
      
      // Reset helpers to original state
      helpers = [...originalHelpers];
      // Filter non-rejected helpers AND those with non-blank status
      const nonRejected = helpers.filter(h =>
        !h.isRejected && 
        !h.isWithdrew && 
        !h.isSelected &&
        h.status.trim() !== '' // Hide blank status helpers
      );
      filteredHelpers = [...nonRejected];
      currentPage = 1;
      updatePagination(filteredHelpers);
      displayResults(getPaginatedData(filteredHelpers));
      document.getElementById('resultsCount').textContent = `${nonRejected.length} Helper${nonRejected.length === 1 ? '' : 's'} Found`;
      
      showNotification('Filters have been reset', 'info');
    }

    // Get data for current page
    function getPaginatedData(data) {
      const startIndex = (currentPage - 1) * helpersPerPage;
      const endIndex = startIndex + helpersPerPage;
      return data.slice(startIndex, endIndex);
    }

    // Update pagination UI
    function updatePagination(data) {
      totalPages = Math.ceil(data.length / helpersPerPage);
      const pageInfo = document.getElementById('pageInfo');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      
      pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
      
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage === totalPages || totalPages === 0;
      
      // Remove existing page number buttons
      document.querySelectorAll('.page-btn').forEach(btn => btn.remove());
      
      // Add page number buttons
      const paginationContainer = document.getElementById('pagination');
      const pageInfoElement = document.getElementById('pageInfo');
      
      // Calculate which page numbers to show
      let startPage = Math.max(1, currentPage - 2);
      let endPage = Math.min(totalPages, currentPage + 2);
      
      // Adjust if we're near the start
      if (currentPage <= 3) {
        endPage = Math.min(5, totalPages);
      }
      
      // Adjust if we're near the end
      if (currentPage >= totalPages - 2) {
        startPage = Math.max(1, totalPages - 4);
      }
      
      // Create page buttons
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.classList.add('pagination-btn', 'page-btn');
        if (i === currentPage) pageBtn.classList.add('active');
        pageBtn.textContent = i;
        pageBtn.addEventListener('click', () => {
          currentPage = i;
          updatePagination(filteredHelpers);
          displayResults(getPaginatedData(filteredHelpers));
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        paginationContainer.insertBefore(pageBtn, pageInfoElement);
      }
    }

    // Next page function
    function nextPage() {
      if (currentPage < totalPages) {
        currentPage++;
        updatePagination(filteredHelpers);
        displayResults(getPaginatedData(filteredHelpers));
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    // Previous page function
    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        updatePagination(filteredHelpers);
        displayResults(getPaginatedData(filteredHelpers));
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function displayResults(data) {
      const container = document.getElementById('results');
      if (data.length === 0) {
        container.innerHTML = `
          <div class="empty-results">
            <i class="fas fa-search"></i>
            <h3>No Helpers Found</h3>
            <p>Try adjusting your search criteria or using different keywords</p>
            <button class="search-btn" onclick="resetFilters()" style="margin-top:20px;padding:12px 25px;">
              <i class="fas fa-redo"></i> Reset Filters
            </button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = data.map(h => `
        <div class="helper ${h.isRejected ? 'rejected' : ''}">
          <div class="helper-header">
            <div class="helper-name-container">
              <h3 class="helper-name">${h.name}</h3>
              <button class="copy-name-btn" onclick="copyHelperName('${h.name}')" title="Copy name">
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div class="helper-code">${h.code}</div>
          </div>
          
          <div class="helper-stats">
            <div class="stat-item">
              <span class="stat-label"><i class="fas fa-flag"></i> Nationality</span>
              <span class="stat-value">${h.nationality}</span>
            </div>
            
            <div class="stat-item">
              <span class="stat-label"><i class="fas fa-briefcase"></i> Experience</span>
              <span class="stat-value">${h.experience}</span>
            </div>
            
            <div class="stat-item">
              <span class="stat-label"><i class="fas fa-birthday-cake"></i> Age</span>
              <span class="stat-value">${h.age || 'N/A'} years</span>
            </div>
            
            <!-- Merged Height & Weight -->
            <div class="stat-item">
              <span class="stat-label"><i class="fas fa-user"></i> Height & Weight</span>
              <div class="merged-stat">
                <span><i class="fas fa-arrows-alt-v"></i> ${h.height || 'N/A'} cm</span>
                <span class="stat-divider">|</span>
                <span><i class="fas fa-weight"></i> ${h.weight || 'N/A'} kg</span>
              </div>
            </div>
            
            <!-- Merged Rest Day & Salary -->
            <div class="stat-item">
              <span class="stat-label"><i class="fas fa-calendar-day"></i> Rest day & Salary</span>
              <div class="merged-stat">
                <span><i class="fas fa-calendar"></i> ${h.restDay || 'N/A'}</span>
                <span class="stat-divider">|</span>
                <span><i class="fas fa-money-bill"></i> ${h.salary || 'N/A'}</span>
              </div>
            </div>
            
            <!-- Added Religion -->
            <div class="stat-item">
              <span class="stat-label"><i class="fas fa-pray"></i> Religion</span>
              <span class="stat-value">${h.religion || 'N/A'}</span>
            </div>
          </div>
          
          <div class="badge-container">
            <div class="badge ${h.housekeeping ? 'active' : ''}">
              <i class="fas fa-home"></i> Housekeep
            </div>
            
            <div class="badge ${h.cooking ? 'active' : ''}">
              <i class="fas fa-utensils"></i> Cooking
            </div>

            <div class="badge ${h.petCare ? 'active' : ''}">
              <i class="fas fa-paw"></i> Pet Care
            </div>
            
            <div class="badge ${h.childCare ? 'active' : ''}">
              <i class="fas fa-child"></i> Child Care
            </div>
            
            <div class="badge ${h.infantCare ? 'active' : ''}">
              <i class="fas fa-baby"></i> Infant Care
            </div>
            
            <div class="badge ${h.elderCare ? 'active' : ''}">
              <i class="fas fa-user-md"></i> Elder Care
            </div>
          </div>
          
          <div class="comments">
            <strong>Comments:</strong> ${h.comments}
          </div>
        </div>
      `).join('');
    }

    // Load data when page is ready
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      
      // Add event listeners for pagination
      document.getElementById('prevBtn').addEventListener('click', prevPage);
      document.getElementById('nextBtn').addEventListener('click', nextPage);
      
      // Skills filter dropdown toggle
      const skillsSelect = document.getElementById('skillsSelect');
      const skillsDropdown = document.getElementById('skillsDropdown');
      
      skillsSelect.addEventListener('click', () => {
        skillsDropdown.classList.toggle('active');
        skillsSelect.classList.toggle('active');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!skillsSelect.contains(e.target)) {
          skillsDropdown.classList.remove('active');
          skillsSelect.classList.remove('active');
        }
      });
      
      // Update selected skills when a checkbox changes
      document.querySelectorAll('.skills-dropdown input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', updateSelectedSkillsDisplay);
      });
    });
  </script>
</body>
</html>
